!function(e){var n=function(n){var t=e(n),a=t.get(0),i=a.getContext("2d"),o=some.Graphics(a),d=null,l=null,r=null,s=null,c=null,u=(new Date).valueOf(),h={init:function(n){d=n,d.screen({size:{width:t.width(),height:t.height()},padding:[36,60,36,60]}),e(window).resize(h.resize),h.resize(),h._initMouseHandling(u)},resize:function(){a.width=e(window).width(),a.height=.75*e(window).height(),d.screen({size:{width:a.width,height:a.height}}),l=null,h.redraw()},redraw:function(){o.clear(),d.eachEdge(function(e,n,t){e.source.data.alpha*e.target.data.alpha!=0&&o.line(n,t,{stroke:"#b2b19d",width:2,alpha:e.target.data.alpha})}),d.eachNode(function(e,n){var t=Math.max(20,20+o.textWidth(e.name));0!==e.data.alpha&&("dot"==e.data.shape?(o.oval(n.x-t/2,n.y-t/2,t,t,{fill:e.data.color,alpha:e.data.alpha}),o.text(e.name,n.x,n.y+7,{color:"white",align:"center",font:"Arial",size:12}),o.text(e.name,n.x,n.y+7,{color:"white",align:"center",font:"Arial",size:12})):(o.rect(n.x-t/2,n.y-8,t,20,4,{fill:e.data.color,alpha:e.data.alpha}),o.text(e.name,n.x,n.y+9,{color:"white",align:"center",font:"Arial",size:12}),o.text(e.name,n.x,n.y+9,{color:"white",align:"center",font:"Arial",size:12})))}),h._drawVignette()},_drawVignette:function(){var e=a.width,n=a.height,t=20;if(!l){var o=i.createLinearGradient(0,0,0,t);o.addColorStop(0,"#e0e0e0"),o.addColorStop(.7,"rgba(255,255,255,0)");var d=i.createLinearGradient(0,n-t,0,n);d.addColorStop(0,"rgba(255,255,255,0)"),d.addColorStop(1,"white"),l={top:o,bot:d}}i.fillStyle=l.top,i.fillRect(0,0,e,t),i.fillStyle=l.bot,i.fillRect(0,n-t,e,t)},switchSection:function(n){var t=d.getEdgesFrom(n)[0].source,a=e.map(d.getEdgesFrom(n),function(e){return e.target});d.eachNode(function(n){if(1!=n.data.showOnTop){var i=e.inArray(n,a)>=0||d.getEdgesTo(a[0])[0].source==n,o=i?1:0,l=.5;d.tweenNode(n,l,{alpha:o}),1==o?(n.data.visible=!0,n.p.x=t.p.x+.05*Math.random()-.025,n.p.y=t.p.y+.05*Math.random()-.025,n.tempMass=.001):n.data.visible=!1}})},_initMouseHandling:function(n){r=null,s=null;var i=null,o=null,l={moved:function(i){var l=e(a).offset();if(c=some.Point(i.pageX-l.left,i.pageY-l.top),s=d.nearest(c),!s.node)return!1;if("dot"!=s.node.data.shape)r=s.distance<50?s:null,r?(t.addClass("linkable"),window.status=r.node.data.link.replace(/^\//,"http://"+window.location.host+"/").replace(/^#/,"")):(t.removeClass("linkable"),window.status="");else{if(s.node.name!=o&&s.node.data.visible){var u=(new Date).valueOf();if(n>u)return!1;n=u+500,o=s.node.name,h.switchSection(o)}t.removeClass("linkable"),window.status=""}return!1},dblclick:function(n){r=s.distance<50?s:null;var t=e(a).offset();if(c=some.Point(n.pageX-t.left,n.pageY-t.top),s=d.nearest(c),s&&r&&s.node===r.node){var i=r.node.data.link;return i.match(/^#/)?e(h).trigger({type:"navigate",path:i.substr(1)}):window.location=i,!1}},clicked:function(n){return i=d.nearest(c),i&&null!==i.node&&(i.node.fixed=!0),e(a).unbind("mousemove",l.moved),e(a).bind("mousemove",l.dragged),e(window).bind("mouseup",l.dropped),!1},dragged:function(n){var t=(s&&s.node._id,e(a).offset()),o=some.Point(n.pageX-t.left,n.pageY-t.top);if(s){if(null!==i&&null!==i.node){var l=d.fromScreen(o);i.node.p=l}return!1}},dropped:function(n){return null!==i&&void 0!==i.node?(null!==i.node&&(i.node.fixed=!1),i.node.tempMass=1e3,i=null,e(a).unbind("mousemove",l.dragged),e(window).unbind("mouseup",l.dropped),e(a).bind("mousemove",l.moved),c=null,!1):void 0}};e(a).mousedown(l.clicked),e(a).mousemove(l.moved),e(a).dblclick(l.dblclick)}};return h};e(document).ready(function(){var e=function(n,t,a){if(null!=n){if("undefined"==typeof t){var t={nodes:{},edges:{}};a=1}if(0==n.length)return t;if("undefined"==typeof t.nodes[n.name]&&(t.nodes[n.name]={color:n.color,shape:"dot",alpha:a,link:n.link,showOnTop:!0,visible:!0}),"undefined"!=typeof n.children){n.children.length>0&&(t.edges[n.name]={});for(var i in n.children)t.nodes[n.children[i].name]={color:n.children[i].color,shape:"undefined"==typeof n.children[i].children?"":"dot",alpha:a,link:n.children[i].link,showOnTop:1==a?!0:!1,visible:1==a?!0:!1},1==a?t.edges[n.name][n.children[i].name]={length:.8}:t.edges[n.name][n.children[i].name]={length:.8},e(n.children[i],t,0);return t}}},t=e(getData()),a=some.ParticleSystem();a.parameters({stiffness:900,repulsion:2e3,gravity:!0,dt:.015}),a.renderer=n("#sitemap"),a.graft(t)})}(this.jQuery);